function forEach(collection,callback){var index,child;if(collection instanceof Array){collection.forEach(callback)}else if("length"in collection){for(index=0;index<collection.length;index++){if(callback(collection[index],index,collection)===false){break}}}else if(collection instanceof Element){index=0;for(child=collection.firstChild;child;child=child.nextSibling){if(child.nodeType==Node.ELEMENT_NODE){if(callback(child,index,collection)===false){break}index++}}}else{for(index in collection){if(callback(collection[index],index,collection)===false){break}}}}Array.prototype.intersect=function(other){return this.filter(function(element){return other.indexOf(element)>-1})};Array.prototype.diff=function(other){return this.filter(function(element){return other.indexOf(element)==-1})};function extend(base,members){var k,f;f=function(){this.init.apply(this,Array.prototype.slice.call(arguments))};if(base!=Object){f.prototype=Object.create(base.prototype)}for(k in members){f.prototype[k]=members[k]}if(!("init"in f.prototype)){f.prototype.init=function(){}}return f}function collapse(element,toHeight){toHeight=toHeight||0;if(!element._transitions){element._transitions=new Transitions(element);element._heightDelay=element._transitions.getTime("height")}delay=element._transitions.getTime("height");element._transitions.set("height");element.style.height=element.offsetHeight+"px";setTimeout(function(){element._transitions.set("height",element._heightDelay);element.style.height=toHeight+"px"},10)}function expand(element){if(!element._transitions){element._transitions=new Transitions(element);element._heightDelay=element._transitions.getTime("height")}element.style.height=element.scrollHeight+"px";setTimeout(function(){element._transitions.set("height");element.style.height="auto";element._transitions.set("height",element._heightDelay)},Math.round(element._heightDelay*1e3))}var UtilEventDispatcher=extend(Object,{on:function(event,listener){if(!("listeners"in this)){this.listeners={}}if(!(event in this.listeners)){this.listeners[event]=[]}this.listeners[event].push(listener)},off:function(event,listener){if("listeners"in this&&event in this.listeners){for(i=0;i<this.listeners[event].length;i++){if(this.listeners[event][i]==listener){this.listeners[event].splice(i,1);break}}}this.listeners[event].push(listener)},dispatch:function(event){var args,i;if("listeners"in this&&event in this.listeners&&this.listeners[event].length>0){args=Array.prototype.slice.call(arguments,1);for(i=0;i<this.listeners[event].length;i++){this.listeners[event][i].apply(this,args)}}}});var FilterKit={resolveElement:function(el,multi){if(typeof el=="string"){return multi?document.querySelectorAll(el):document.querySelector(el)}else if(!(el instanceof Element)){return!multi&&el.length?el[0]:el}return multi?[el]:el},resolveOptions:function(options,defaults){var key;options=options||{};defaults=defaults||{};for(key in defaults){if(!(key in options)){options[key]=defaults[key]}}return options},createElement:function(spec,attrs,style){var m,m2,i,tagName="div",el;if(m=spec.match(/^([a-zA-Z][a-zA-Z\-_:]*)/)){tagName=m[1]}el=document.createElement(tagName);m=spec.match(/#([a-zA-Z][a-zA-Z0-9\-_:]*)/);if(m){el.id=m[1]}m=spec.match(/(\.[a-zA-Z][a-zA-Z0-9\-_:.]*)+/);if(m){el.className=m[0].substr(1).replace(/\./g," ")}m=spec.match(/\[[^=]+="[^"]*"\]/g);if(m){for(i=0;i<m.length;i++){m2=m[i].match(/\[([^=]+)="([^"]*)"\]/);el.setAttribute(m2[1],m2[2])}}if(attrs){for(i in attrs){el.setAttribute(i,attrs[i])}}if(style){for(i in style){el.style[i]=style[i]}}return el},getUid:function(prefix){var result;if(!this._uid){this._uid=0}result=(prefix||"")+this._uid;this._uid++;return result},Conditions:{},SelectOutput:{},Controls:{},Collections:{},CollectionViews:{},Util:{}};FilterKit.Conditions.Base=extend(Object,{init:function(initValue){this.value=initValue||""},addValue:function(value){if(this.value instanceof Array){if(value instanceof Array){this.value=this.value.concat(value)}else{this.value.push(value)}}else{if(value instanceof Array){this.value=[this.value].concat(value)}else{this.value=[this.value,value]}}},removeValue:function(value){var index;if(this.value instanceof Array){if(value instanceof Array){this.value=this.value.diff(this.value,value)}else{index=this.value.indexOf(value);if(index>-1){this.value.splice(index,1)}}}else if(this.value==value){this.value=null}},hasValues:function(value){return this.value!==null&&(!(this.value instanceof Array)||this.value.length>0)},checkValue:function(value){return true},serializeQuery:function(name){return""}});FilterKit.Conditions.Eq=extend(FilterKit.Conditions.Base,{checkValue:function(value){if(this.value instanceof Array){if(value instanceof Array){return this.value.intersect(value).length>0}else{return this.value.indexOf(value)>-1}}else{if(value instanceof Array){return value.indexOf(this.value)>-1}else{return this.value==value}}},serializeQuery:function(name){var queryParts=[];if(this.value instanceof Array){if(this.value.length==1){queryParts.push(name+"="+encodeURIComponent(this.value[0]))}else{this.value.forEach(function(value){queryParts.push(name+"[]="+encodeURIComponent(value))})}}else{queryParts.push(name+"="+encodeURIComponent(this.value))}return queryParts.join("&")}});FilterKit.Conditions.Like=extend(FilterKit.Conditions.Base,{addValue:function(value){this.value=value.toLowerCase()},checkValue:function(value){return(""+value).toLowerCase().indexOf(this.value)>-1},serializeQuery:function(name){var queryParts=[];if(this.value instanceof Array){if(this.value.length==1){queryParts.push(name+"="+encodeURIComponent(this.value[0]))}else{this.value.forEach(function(value){queryParts.push(name+"[]="+encodeURIComponent(value))})}}else{queryParts.push(name+"="+encodeURIComponent(this.value))}return queryParts.join("&")}});FilterKit.Conditions.Lt=extend(FilterKit.Conditions.Base,{checkValue:function(value){return value<this.value},serializeQuery:function(name){return name+"[lt]="+encodeURIComponent(this.value)}});FilterKit.Conditions.Lte=extend(FilterKit.Conditions.Base,{checkValue:function(value){return value<=this.value},serializeQuery:function(name){return name+"[lte]="+encodeURIComponent(this.value)}});FilterKit.Conditions.Gt=extend(FilterKit.Conditions.Base,{checkValue:function(value){return value>this.value},serializeQuery:function(name){return name+"[gt]="+encodeURIComponent(this.value)}});FilterKit.Conditions.Gte=extend(FilterKit.Conditions.Base,{checkValue:function(value){return value>=this.value},serializeQuery:function(name){return name+"[gte]="+encodeURIComponent(this.value)}});FilterKit.Conditions.Geo=extend(FilterKit.Conditions.Base,{init:function(initValue){this.addValue(initValue)},addValue:function(value){var values;if(value instanceof Array){value=value[0]}values=value.split(",");this.lat=parseFloat(values[0]);this.lng=parseFloat(values[1]);this.distance=parseFloat(values[2]);this.searchString=values.length>3?values.slice(3).join(","):null},removeValue:function(value){this.lat=null},hasValues:function(){return this.lat!==null},checkValue:function(value){var distance;function radians(degrees){return degrees*Math.PI/180}function degrees(radians){return degrees*180/Math.PI}distance=degrees(Math.acos(Math.cos(radians(90-value.lat))*Math.cos(radians(90-this.lat))+Math.sin(radians(90-value.lat))*Math.sin(radians(90-thia.lat))*Math.cos(radians(value.lng-this.lng))))/360*40074;return distance<=this.distance},serializeQuery:function(name){return name+"[geo]="+encodeURIComponent(this.lat)+","+encodeURIComponent(this.lng)+","+encodeURIComponent(this.distance)+(this.searchString?","+encodeURIComponent(this.searchString):"")}});FilterKit.Value=extend(Object,{init:function(){this.conditions={}},addCondition:function(operand,value){if(operand in this.conditions){this.conditions[operand].addValue(value)}else{cls=operand?operand[0].toUpperCase()+operand.substr(1):"Eq";this.conditions[operand]=new FilterKit.Conditions[cls](value)}},removeCondition:function(operand,value){if(operand in this.conditions){this.conditions[operand].removeValue(value);if(!this.conditions[operand].hasValues()){delete this.conditions[operand]}}},checkValue:function(value){var operand,match=true;for(operand in this.conditions){match=this.conditions[operand].checkValue(value);if(!match){break}}return match},serializeQuery:function(name){var key,queryParts=[];for(key in this.conditions){queryParts.push(this.conditions[key].serializeQuery(name))}return queryParts.join("&")}});FilterKit.Filters=extend(UtilEventDispatcher,{init:function(){this.filters={};this.filterTags={};this.keyLabels={};this.valueLabels={};this.isBatching=false},getHash:function(key,value){return key+"_"+value},checkItem:function(item){var key,match=true,property;for(key in this.filters){if(key in item){match=this.filters[key].checkValue(item[key]);if(!match){break}}}return match},addValue:function(name,value,operand,replace){var tag,key;operand=operand||"eq";if(!(name in this.filters)||replace){this.clearValue(name);this.filters[name]=new FilterKit.Value;this.filterTags[name]={}}this.filters[name].addCondition(operand,value);tag={key:name,value:value,keyLabel:name,valueLabel:value,operand:operand,hash:this.getHash(name,value)};if(name in this.keyLabels){tag.keyLabel=this.keyLabels[name]}if(tag.hash in this.valueLabels){tag.valueLabel=this.valueLabels[tag.hash]}if(operand=="geo"&&this.filters[name].conditions.geo.searchString){tag.valueLabel=this.filters[name].conditions.geo.searchString}this.filterTags[name][tag.hash]=tag;this.dispatch("addtag",tag);if(!this.isBatching){this.dispatch("change")}else{this.batchChanges++}},removeValue:function(name,value,operand){var hash;operand=operand||"eq";if(name in this.filters){this.filters[name].removeCondition(operand,value);hash=this.getHash(name,value);if(hash in this.filterTags[name]){this.dispatch("removetag",this.filterTags[name][hash])}}if(!this.isBatching){this.dispatch("change")}else{this.batchChanges++}},clearValue:function(name){var hash;if(name in this.filterTags){for(hash in this.filterTags[name]){this.dispatch("removetag",this.filterTags[name][hash])}delete this.filterTags[name]}if(name in this.filters){delete this.filters[name]}},clearAll:function(){var name;for(name in this.filters){this.clearValue(name)}if(!this.isBatching){this.dispatch("change")}else{this.batchChanges++}},serializeQuery:function(){var key,queryParts=[];for(key in this.filters){queryParts.push(this.filters[key].serializeQuery(key))}return queryParts.join("&")},startBatch:function(){this.batchChanges=0;this.isBatching=true},endBatch:function(){if(this.isBatching&&this.batchChanges>0){this.dispatch("change")}this.isBatching=false},unserializeQuery:function(query){var i,key,operand,value,queryParts,m;this.startBatch();this.clearAll();queryParts=query.replace(/^\?/,"").split("&");for(i=0;i<queryParts.length;i++){if(m=queryParts[i].match(/^([^\[=]+)(\[[^\]]*\])?=([^$]*)/)){key=m[1];operand=m[2]?m[2].replace(/^\[|\]$/g,""):"eq";value=decodeURIComponent(m[3]);this.addValue(key,value,operand,operand=="geo")}}this.endBatch()},setKeyLabel:function(key,label){this.keyLabels[key]=label},setValueLabel:function(key,value,label){this.valueLabels[this.getHash(key,value)]=label},setLabels:function(labels){var key,i;for(key in labels){if(key!="introtext"&&key!="fulltext"){if("label"in labels[key]){this.setKeyLabel(key,labels[key].label)}if("options"in labels[key]){for(i in labels[key].options){if("label"in labels[key].options[i]){this.setValueLabel(key,labels[key].options[i].value,labels[key].options[i].label)}}}}}}});FilterKit.Collections.Base=extend(UtilEventDispatcher,{setFilters:function(filters){this.filters=filters;filters.on("change",this.update.bind(this))},update:function(){var i;for(i=0;i<this.items.length;i++){this.items[i].isFiltered=this.filters.checkItem(this.items[i])}this.dispatch("update",this.items)},getPreviousFilteredItem:function(fromIndex,wrap,returnIndex){var index;index=fromIndex=fromIndex==-1?0:fromIndex;do{index--;if(index<=0){if(wrap){index=index+this.items.length-1}else{index=0;break}}}while(index!=fromIndex&&!this.items[index].isFiltered);return returnIndex?index:this.items[index]},getNextFilteredItem:function(fromIndex,wrap,returnIndex){var index;index=fromIndex=typeof fromIndex=="undefined"?-1:fromIndex;do{index++;if(index>this.items.length){if(wrap){index=0}else{index=this.items.length-1;break}}}while(index!=fromIndex&&index<this.items.length&&!this.items[index].isFiltered);return returnIndex?index:this.items[index]},selectItem:function(value,replace){var i;if(typeof value=="object"){if(this.items.indexOf(value)>-1){if(replace){for(i=0;i<this.items.length;i++){this.items[i].isSelected=false}}value.isSelected=true;this.dispatch("selectItem",value,replace)}}else{for(i=0;i<this.items.length;i++){if(this.items[i].value==value){this.items[i].isSelected=true;this.dispatch("selectItem",this.items[i],replace)}else if(replace){this.items[i].isSelected=false}}}}});FilterKit.Collections.DOM=extend(FilterKit.Collections.Base,{init:function(el,filters,options){this.container=FilterKit.resolveElement(el);this.options=FilterKit.resolveOptions(options,{itemSelector:".item"});this.collectItems();this.setFilters(filters)},collectItems:function(){var elements,callback,that,uid;function elementToItem(el){var item={value:el.getAttribute("data-value")||uid+"",label:el.textContent.replace(/^\s+|\s+$/g,"")};if(item.value==uid){uid++;el.setAttribute("data-value",item.value)}return item}uid=0;elements=this.container.querySelectorAll(this.options.itemSelector);that=this;callback="elementToItem"in this.options?this.options.elementToItem:elementToItem;this.items=[];forEach(elements,function(el){var item=callback(el);item.element=el;item.isFiltered=true;that.items.push(item)})}});FilterKit.Collections.Array=extend(FilterKit.Collections.Base,{init:function(items,filters){this.items=items;forEach(this.items,function(item){item.isFiltered=true});this.setFilters(filters)}});FilterKit.Collections.AjaxJSON=extend(FilterKit.Collections.Base,{init:function(filters,options){this.options=FilterKit.resolveOptions(options,{baseUrl:location.pathname});this.setFilters(filters)},parseResponse:function(responseText){result=JSON.parse(responseText);this.items=result instanceof Array?result:result.items;forEach(this.items,function(item){item.isFiltered=true});this.dispatch("update",this.items)},fetchItems:function(url){var xhr,that;if(!this.isFetching){this.isFetching=true;that=this;xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){var result,url;if(this.readyState==4){if(this.status==200){that.parseResponse(this.responseText)}else{console.error("Fetch JSON items - "+url+" responded with "+this.statusText)}that.isFetching=false;if(that.queueUrl){url=that.queueUrl;that.queueUrl=null;that.fetchItems(url)}}};xhr.open("get",url,true);xhr.send()}else{this.queueUrl=url}},update:function(){var query,url;query=this.filters.serializeQuery();url=this.options.baseUrl+(query?"?"+query:"");this.fetchItems(url)}});FilterKit.Collections.AjaxHTML=extend(FilterKit.Collections.AjaxJSON,{parseResponse:function(responseText){that.dispatch("update",responseText)}});FilterKit.CollectionViews.Div=extend(Object,{init:function(el,collection,options){var templateEl;this.container=FilterKit.resolveElement(el);this.collection=collection;this.options=FilterKit.resolveOptions(options,{showSelected:"highlighted",maxVisible:0});templateEl=this.container.querySelector(".itemtemplate");if(templateEl){this.template=templatify(templateEl.innerHTML);templateEl.parentElement.removeChild(templateEl)}collection.on("update",this.onUpdate.bind(this));collection.on("selectItem",this.onSelect.bind(this));this.container.addEventListener("click",function(e){e.preventDefault();if(e.target.classList.contains("item")){collection.selectItem(e.target.getAttribute("data-value"),true)}})},onUpdate:function(result){var i,html,numVisible;if(typeof result=="string"){this.container.innerHTML=result}else if(this.template){for(i=0;i<result.length;i++){if(!result[i].isSelected||this.options.showSelected!="hidden"){html+=this.template(result[i]);if(++numVisible>=this.options.maxVisible&&this.options.maxVisible>0){break}}}this.container.innerHTML=html}else{for(i=0;i<result.length;i++){if("element"in result[i]){if(result[i].isFiltered&&(!result[i].isSelected||this.options.showSelected!="hidden")){result[i].element.style.display="block";if(++numVisible>=this.options.maxVisible&&this.options.maxVisible>0){break}}else{result[i].element.style.display="none"}}}}},onSelect:function(item,replace){switch(this.options.showSelected){case"highlighted":this.highlightItem(item,"active",replace);break;case"hidden":item.element.style.display="none";break}},highlightItem:function(item,className,replace){var currHighlighted,items;className=className||"highlight";if(replace){currHighlighted=this.container.querySelector("."+className);if(currHighlighted){currHighlighted.classList.remove(className)}}if("element"in item){item.element.classList.add(className)}else{items=this.container.querySelectorAll(".item");forEach(items,function(it){if(it.getAttribute("data-value")==item.value){it.classList.add(className)}})}}});const NAVKEY_BACKSPACE=8;const NAVKEY_BACKSPACE_EMPTY=88;const NAVKEY_UPARROW=38;const NAVKEY_DOWNARROW=40;const NAVKEY_RETURN=13;FilterKit.Controls.Textfield=extend(Object,{init:function(el,filters,options){var that=this;input=FilterKit.resolveElement(el);options=FilterKit.resolveOptions(options,{realTime:false,keyboardNavigation:false,operand:"like"});if(input){if(!input.name){input.name=FilterKit.getUid("textfield")}input.addEventListener("keydown",function(e){if(e.which==13){e.preventDefault()}else if(options.keyboardNavigation&&(e.which==NAVKEY_UPARROW||e.which==NAVKEY_DOWNARROW)){e.preventDefault();that.onNavigationKey(e.which)}this.lastValue=this.value});input.addEventListener("keyup",function(e){if(e.which==13){e.preventDefault();filters.addValue(this.name,this.value,options.operand,true)}else if(options.realTime){filters.addValue(this.name,this.value,options.operand,true)}if(options.keyboardNavigation&&(e.which==NAVKEY_BACKSPACE||e.which==NAVKEY_RETURN)){if(e.which==NAVKEY_BACKSPACE&&!this.lastValue){that.onNavigationKey(NAVKEY_BACKSPACE_EMPTY)}else{that.onNavigationKey(e.which)}}})}},onNavigationKey:function(key){}});FilterKit.Controls.Checkboxes=extend(Object,{init:function(el,filters){var container,checkboxes;function onCbChange(e){if(this.checked){filters.addValue(this.name.replace(/\[\]$/,""),this.value)}else{filters.removeValue(this.name.replace(/\[\]$/,""),this.value)}}container=FilterKit.resolveElement(el);checkboxes=container.querySelectorAll('input[type="checkbox"]');forEach(checkboxes,function(checkbox){checkbox.addEventListener("change",onCbChange)})}});FilterKit.Controls.RadioButtons=extend(Object,{init:function(el,filters){var container,radioButtons;function onRadioChange(e){if(this.checked){filters.addValue(this.name,this.value,"eq",true)}}container=FilterKit.resolveElement(el);radioButtons=container.querySelectorAll('input[type="radio"]');forEach(radioButtons,function(radio){radio.addEventListener("change",onRadioChange)})}});FilterKit.Controls.Container=extend(Object,{init:function(el,filters,options){var container,radioButtons,checkboxes,inputs;options=FilterKit.resolveOptions(options,{realTime:false,textFieldOperand:"like"});function onCbChange(e){if(this.checked){filters.addValue(this.name.replace(/\[\]$/,""),this.value)}else{filters.removeValue(this.name.replace(/\[\]$/,""),this.value)}}function onRadioChange(e){if(this.checked){filters.addValue(this.name,this.value,"eq",true)}}function onKeyDown(e){if(e.which==13){e.preventDefault()}}function onKeyUp(e){if(e.which==13){e.preventDefault();filters.addValue(this.name,this.value,options.textFieldOperand,true)}else if(options.realTime){filters.addValue(this.name,this.value,options.textFieldOperand,true)}}container=FilterKit.resolveElement(el);checkboxButtons=container.querySelectorAll('input[type="checkbox"]');forEach(checkboxButtons,function(checkbox){checkbox.addEventListener("change",onCbChange)});radioButtons=container.querySelectorAll('input[type="radio"]');forEach(radioButtons,function(radio){radio.addEventListener("change",onRadioChange)});inputs=container.querySelectorAll('input[type="text"]');forEach(inputs,function(input){input.addEventListener("keyup",onKeyUp);input.addEventListener("keydown",onKeyDown)})}});FilterKit.SelectOutput.Chips=extend(Object,{init:function(el){this.container=FilterKit.resolveElement(el)},createChild:function(value,label){var chip=FilterKit.createElement("div.chip");chip.innerHTML=label+' <i class="close icon"></i>'},selectValue:function(value,label,fullItem){var child=this.createChild(value,label,fullItem);this.container.appendChild(child)}});FilterKit.SelectOutput.Blocks=extend(FilterKit.SelectOutput.Chips,{createChild:function(value,label){var chip=FilterKit.createElement("div.message");chip.innerHTML=label+'<br/><i class="close icon"></i>'}});FilterKit.SelectOutput.Textfield=extend(Object,{init:function(el){this.textField=FilterKit.resolveElement(el)},selectValue:function(value,label,fullItem){this.textField.value=label}});FilterKit.SelectOutput.Text=extend(Object,{init:function(el){this.element=FilterKit.resolveElement(el)},selectValue:function(value,label,fullItem){this.element.innerHTML=label}});FilterKit.Util.Searchbar=function(searchbarEl,collectionEl,options){var filters,searchbar,collection,collectionView;options=FilterKit.resolveOptions(options,{realTime:false,collectionType:"dom",baseUrl:"/"});filters=new FilterKit.Filters;searchbar=new FilterKit.Controls.Textfield(searchbarEl,filters,options);switch(options.collectionType){case"ajax_json":collection=new FilterKit.Collections.AjaxJSON(filters,options);break;case"ajax_html":collection=new FilterKit.Collections.AjaxHTML(filters,options);break;default:collection=new FilterKit.Collections.DOM(collectionEl,filters,options);break}collectionView=new FilterKit.CollectionViews.Div(collectionEl,collection);return filters};FilterKit.Util.SelectionDropdown=function(el,options){var dropdown,input,valueLabel,itemContainer,valueInput,filters,searchInput,collection,collectionView,output,collapseTimeout,hlIndex;dropdown=FilterKit.resolveElement(el);(function(){var wrapper=FilterKit.createElement("div.fdropdownwrap");if(dropdown.classList.contains("fluid")){wrapper.classList.add("fluid")}if(dropdown.classList.contains("solid")){wrapper.classList.add("solid")}dropdown.parentElement.insertBefore(wrapper,dropdown);wrapper.appendChild(dropdown)})();valueInput=dropdown.querySelector('input[type="hidden"]');if(!valueInput){valueInput=FilterKit.createElement('input[type="hidden"]');dropdown.insertBefore(valueInput,dropdown.firstElementChild)}input=dropdown.querySelector('input[type="text"]');if(!input){input=FilterKit.createElement('input[type="text"]');dropdown.insertBefore(input,dropdown.firstElementChild)}input.name="label";valueLabel=dropdown.querySelector(".value");if(!valueLabel){valueLabel=FilterKit.createElement("div.value");dropdown.insertBefore(valueLabel,input.nextElementSibling)}itemContainer=dropdown.querySelector(".items");(function(){var contentPanel,panel,ddIcon;contentPanel=FilterKit.createElement("div.contentpanel");dropdown.appendChild(contentPanel);panel=dropdown.querySelector(".panel");if(itemContainer){contentPanel.appendChild(itemContainer)}if(panel){contentPanel.appendChild(panel)}ddIcon=dropdown.querySelector(".dropdown.icon");if(!ddIcon){ddIcon=FilterKit.createElement("i.dropdown.icon");dropdown.insertBefore(ddIcon,contentPanel)}})();function expand(){cancelCollapse();dropdown.classList.add("expanded")}function delayToCollapse(){collapseTimeout=setTimeout(function(){collapseTimeout=null;dropdown.classList.remove("expanded")},200)}function cancelCollapse(){if(collapseTimeout){clearTimeout(collapseTimeout);collapseTimeout=null}}filters=new FilterKit.Filters;searchInput=new FilterKit.Controls.Textfield(input,filters,{keyboardNavigation:true,realTime:true});collection=new FilterKit.Collections.DOM(itemContainer,filters);collectionView=new FilterKit.CollectionViews.Div(itemContainer,collection);output=new FilterKit.SelectOutput.Text(valueLabel);hlIndex=-1;searchInput.onNavigationKey=function(key){var index,item;switch(key){case NAVKEY_UPARROW:index=collection.getPreviousFilteredItem(hlIndex,false,true);item=index<collection.items.length?collection.items[index]:null;if(item){collectionView.highlightItem(item,"highlight",true);hlIndex=index}break;case NAVKEY_DOWNARROW:index=collection.getNextFilteredItem(hlIndex,false,true);item=index<collection.items.length?collection.items[index]:null;if(item){collectionView.highlightItem(item,"highlight",true);hlIndex=index}break;case NAVKEY_RETURN:if(hlIndex>-1){item=collection.items[hlIndex];collection.selectItem(item,true)}break}};collection.on("selectItem",function(item){output.selectValue(item.value,item.label);valueInput.value=item.value;input.blur()});input.addEventListener("focus",function(){expand()});input.addEventListener("blur",function(){delayToCollapse()})};if("$"in window){$.fn.searchbar=function(target,options){this.each(function(){this._filters=FilterKit.Util.Searchbar(this,target,options)});return this}}
//# sourceMappingURL=filterkit.min.js.map